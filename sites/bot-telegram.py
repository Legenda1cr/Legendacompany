import logging
import random
from telegram import Bot
from telegram.ext import Application, CommandHandler
from apscheduler.schedulers.background import BackgroundScheduler
import asyncio

# –í–∞—à API token
TOKEN = '7735279875:AAEv2_TALe0OzvZUIGbTksvQKPGoJDZHypk'

# –î–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö (–≤–º–µ—Å—Ç–æ —á—Ç–µ–Ω–∏—è –∏–∑ Excel)
employees = [
    {'name': '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤', 'birthday': '01-01'},
    {'name': '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞', 'birthday': '15-03'},
    {'name': '–ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤', 'birthday': '22-07'},
    {'name': '–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –í–æ–ª–∫–æ–≤–∞', 'birthday': '03-11'}
]

# –°–ø–∏—Å–æ–∫ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π
def generate_birthday_message(name):
    messages = [
        f"üéâ –î–æ—Ä–æ–≥–æ–π {name}! –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Ç–µ–±—è —Å —ç—Ç–∏–º –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–º –¥–Ω–µ–º! –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –≥–æ–¥ –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ç–µ–±–µ —Å—á–∞—Å—Ç—å–µ, —É–¥–∞—á—É –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–¥–æ—Å—Ç–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤! üåü",
        f"üéÇ {name}, —Å –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! –ñ–µ–ª–∞–µ–º —Ç–µ–±–µ —è—Ä–∫–∏—Ö —ç–º–æ—Ü–∏–π, —É—Å–ø–µ—Ö–æ–≤ –≤–æ –≤—Å–µ—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏—è—Ö –∏ –±–µ–∑–º–µ—Ä–Ω–æ–≥–æ —Å—á–∞—Å—Ç—å—è! –ü—É—Å—Ç—å —Å–±—É–¥–µ—Ç—Å—è –≤—Å–µ, –æ —á–µ–º —Ç—ã –º–µ—á—Ç–∞–µ—à—å! üéà",
        f"üåü –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è, {name}! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å —Å—Ç–∞–Ω–µ—Ç –Ω–∞—á–∞–ª–æ–º –Ω–æ–≤–æ–≥–æ, –µ—â–µ –±–æ–ª–µ–µ —É–¥–∞—á–Ω–æ–≥–æ –≥–æ–¥–∞ –≤ —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏! –ó–¥–æ—Ä–æ–≤—å—è, —Ä–∞–¥–æ—Å—Ç–∏ –∏ —É—Å–ø–µ—Ö–∞ –≤–æ –≤—Å–µ–º! üçÄ",
        f"üéâ {name}, —Å –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! –ü—É—Å—Ç—å –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å —Ç–µ–±–µ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ —Å–∞–º—ã–µ –ø—Ä–∏—è—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –∞ –≤–ø–µ—Ä–µ–¥–∏ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–µ—Ç–ª—ã–π –∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã–π –ø—É—Ç—å! üéÅ",
        f"ü•≥ {name}, –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Ç–µ–±—è —Å —ç—Ç–∏–º –≤–∞–∂–Ω—ã–º –¥–Ω–µ–º! –ü—É—Å—Ç—å –æ–Ω –ø—Ä–∏–Ω–µ—Å–µ—Ç —Ç–µ–±–µ –º–Ω–æ–≥–æ —Å—á–∞—Å—Ç—å—è, —É–¥–∞—á–∏, —Ä–∞–¥–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∂–µ–ª–∞–Ω–∏–π! –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±—É–¥–µ—Ç –æ—Å–æ–±–µ–Ω–Ω—ã–º! üå∑",
        f"üéà {name}, —Å –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è! –ñ–µ–ª–∞–µ–º —Ç–µ–±–µ –º–æ—Ä–µ —Å—á–∞—Å—Ç—å—è, –æ–∫–µ–∞–Ω —É–¥–∞—á–∏ –∏ —Ä–µ–∫–∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö —ç–º–æ—Ü–∏–π! –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±—É–¥–µ—Ç —è—Ä–∫–∏–º –∏ –ø–æ–ª–Ω—ã–º –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è! üåû"
    ]
    
    # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞
    return random.choice(messages)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
async def send_birthday_wish(context):
    for employee in employees:
        message = generate_birthday_message(employee['name'])
        await context.bot.send_message(chat_id='@ggwpsomatch', text=message)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
def setup_scheduler(application):
    scheduler = BackgroundScheduler()
    # –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–¥–∞—á—É –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    scheduler.add_job(lambda: send_birthday_wish(application), 'interval', minutes=1)
    scheduler.start()

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async def main():
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    application = Application.builder().token(TOKEN).build()

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
    setup_scheduler(application)

    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    await application.run_polling()  # –ó–¥–µ—Å—å —É–∂–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–º —Å–æ–±—ã—Ç–∏–π

if __name__ == '__main__':
    logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
                        level=logging.INFO)
    logging.info("–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...")

    # –ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º main –Ω–∞–ø—Ä—è–º—É—é, —Ç–∞–∫ –∫–∞–∫ run_polling —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ü–∏–∫–ª–æ–º —Å–æ–±—ã—Ç–∏–π
    asyncio.run(main())
